import React, { useState } from 'react';\nimport { Button, Input } from '../comunes/UI';\nimport { useApp } from '../../contexto/useApp';\n\ninterface ChangePasswordFormProps {\n  onSuccess?: () => void;\n  onCancel?: () => void;\n}\n\nexport function ChangePasswordForm({ onSuccess, onCancel }: ChangePasswordFormProps) {\n  const { state } = useApp();\n  const [formData, setFormData] = useState({\n    currentPassword: '',\n    newPassword: '',\n    confirmPassword: ''\n  });\n  const [errors, setErrors] = useState<Record<string, string>>({});\n  const [loading, setLoading] = useState(false);\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { name, value } = e.target;\n    setFormData(prev => ({ ...prev, [name]: value }));\n    // Limpiar error del campo\n    if (errors[name]) {\n      setErrors(prev => ({ ...prev, [name]: '' }));\n    }\n  };\n\n  const validateForm = () => {\n    const newErrors: Record<string, string> = {};\n\n    if (!formData.currentPassword.trim()) {\n      newErrors.currentPassword = 'La contraseña actual es requerida';\n    }\n\n    if (!formData.newPassword.trim()) {\n      newErrors.newPassword = 'La nueva contraseña es requerida';\n    } else if (formData.newPassword.length < 6) {\n      newErrors.newPassword = 'La nueva contraseña debe tener al menos 6 caracteres';\n    }\n\n    if (!formData.confirmPassword.trim()) {\n      newErrors.confirmPassword = 'Debe verificar la nueva contraseña';\n    } else if (formData.newPassword !== formData.confirmPassword) {\n      newErrors.confirmPassword = 'Las contraseñas no coinciden';\n    }\n\n    if (formData.currentPassword === formData.newPassword) {\n      newErrors.newPassword = 'La nueva contraseña debe ser diferente a la actual';\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!validateForm()) return;\n\n    if (!state.user?.id) {\n      setErrors({ general: 'Usuario no identificado' });\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const response = await fetch('http://localhost:8080/api/auth/change-password', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          usuario_id: parseInt(state.user.id),\n          currentPassword: formData.currentPassword,\n          newPassword: formData.newPassword\n        })\n      });\n\n      const data = await response.json();\n      \n      if (data.success) {\n        setFormData({ currentPassword: '', newPassword: '', confirmPassword: '' });\n        setErrors({});\n        if (onSuccess) onSuccess();\n      } else {\n        setErrors({ general: data.message || 'Error al cambiar contraseña' });\n      }\n    } catch (error) {\n      console.error('Error cambiando contraseña:', error);\n      setErrors({ general: 'Error de conexión con el servidor' });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n      <div className=\"mb-6\">\n        <h3 className=\"text-lg font-medium text-gray-900\">Cambiar Contraseña</h3>\n        <p className=\"text-sm text-gray-600 mt-1\">\n          Por seguridad, necesitamos verificar tu contraseña actual antes de cambiarla.\n        </p>\n      </div>\n\n      <form onSubmit={handleSubmit} className=\"space-y-4\">\n        <Input\n          id=\"currentPassword\"\n          name=\"currentPassword\"\n          type=\"password\"\n          label=\"Contraseña Actual\"\n          value={formData.currentPassword}\n          onChange={handleInputChange}\n          error={errors.currentPassword}\n          placeholder=\"Ingrese su contraseña actual\"\n          required\n        />\n\n        <Input\n          id=\"newPassword\"\n          name=\"newPassword\"\n          type=\"password\"\n          label=\"Nueva Contraseña\"\n          value={formData.newPassword}\n          onChange={handleInputChange}\n          error={errors.newPassword}\n          placeholder=\"Ingrese la nueva contraseña\"\n          required\n        />\n\n        <Input\n          id=\"confirmPassword\"\n          name=\"confirmPassword\"\n          type=\"password\"\n          label=\"Verificar Nueva Contraseña\"\n          value={formData.confirmPassword}\n          onChange={handleInputChange}\n          error={errors.confirmPassword}\n          placeholder=\"Confirme la nueva contraseña\"\n          required\n        />\n\n        {errors.general && (\n          <div className=\"bg-red-50 border border-red-200 rounded-md p-4\">\n            <div className=\"text-sm text-red-600\">\n              {errors.general}\n            </div>\n          </div>\n        )}\n\n        <div className=\"flex space-x-3 pt-4\">\n          {onCancel && (\n            <Button\n              type=\"button\"\n              onClick={onCancel}\n              variant=\"secondary\"\n              className=\"flex-1\"\n            >\n              Cancelar\n            </Button>\n          )}\n          \n          <Button\n            type=\"submit\"\n            loading={loading}\n            className=\"flex-1\"\n          >\n            Cambiar Contraseña\n          </Button>\n        </div>\n      </form>\n\n      <div className=\"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-md\">\n        <div className=\"text-xs text-blue-700\">\n          <strong>Consejos de seguridad:</strong>\n          <ul className=\"mt-2 space-y-1 list-disc list-inside\">\n            <li>Use al menos 6 caracteres</li>\n            <li>Combine letras, números y símbolos</li>\n            <li>Evite palabras comunes o información personal</li>\n            <li>No comparta su contraseña con nadie</li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  );\n}\n